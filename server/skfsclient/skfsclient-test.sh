#!/bin/bash
SKFSCLIENT_PATH=$1
ORIGIN=$2
USERNAME=$3
OPTIONS=$4

#Example command:
#./skfsclient-test.sh target/dist/skfsclient.jar https://fido-poc.strongkey.com:8181 scootscottscoot -Djavax.net.ssl.trustStore=$STRONGKEY_HOME/certs/cacerts

#REST HMAC
java -jar $OPTIONS $SKFSCLIENT_PATH R $ORIGIN 1 REST HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $USERNAME $ORIGIN
java -jar $OPTIONS $SKFSCLIENT_PATH A $ORIGIN 1 REST HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $USERNAME $ORIGIN 1
GETKEYS_OUTPUT=$(java -jar $OPTIONS $SKFSCLIENT_PATH G $ORIGIN 1 REST HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $USERNAME)
echo $GETKEYS_OUTPUT
RANDOMID=$(echo $GETKEYS_OUTPUT | grep -o -P '(?<=randomid":").*(?=","randomid_)')
java -jar $OPTIONS $SKFSCLIENT_PATH U $ORIGIN 1 REST HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $RANDOMID new-display-name Active
java -jar $OPTIONS $SKFSCLIENT_PATH D $ORIGIN 1 REST HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $RANDOMID
java -jar $OPTIONS $SKFSCLIENT_PATH P $ORIGIN 1 REST HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4

#REST PASSWORD
java -jar $OPTIONS $SKFSCLIENT_PATH R $ORIGIN 1 REST PASSWORD svcfidouser Abcd1234! $USERNAME $ORIGIN
java -jar $OPTIONS $SKFSCLIENT_PATH A $ORIGIN 1 REST PASSWORD svcfidouser Abcd1234! $USERNAME $ORIGIN 1
GETKEYS_OUTPUT=$(java -jar $OPTIONS $SKFSCLIENT_PATH G $ORIGIN 1 REST PASSWORD svcfidouser Abcd1234! $USERNAME)
echo $GETKEYS_OUTPUT
RANDOMID=$(echo $GETKEYS_OUTPUT | grep -o -P '(?<=randomid":").*(?=","randomid_)')
java -jar $OPTIONS $SKFSCLIENT_PATH U $ORIGIN 1 REST PASSWORD svcfidouser Abcd1234! $RANDOMID new-display-name Active
java -jar $OPTIONS $SKFSCLIENT_PATH D $ORIGIN 1 REST PASSWORD svcfidouser Abcd1234! $RANDOMID
java -jar $OPTIONS $SKFSCLIENT_PATH P $ORIGIN 1 REST PASSWORD svcfidouser Abcd1234!

#SOAP HMAC
java -jar $OPTIONS $SKFSCLIENT_PATH R $ORIGIN 1 SOAP HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $USERNAME $ORIGIN
java -jar $OPTIONS $SKFSCLIENT_PATH A $ORIGIN 1 SOAP HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $USERNAME $ORIGIN 1
GETKEYS_OUTPUT=$(java -jar $OPTIONS $SKFSCLIENT_PATH G $ORIGIN 1 SOAP HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $USERNAME)
echo $GETKEYS_OUTPUT
RANDOMID=$(echo $GETKEYS_OUTPUT | grep -o -P '(?<=randomid":").*(?=","randomid_)')
java -jar $OPTIONS $SKFSCLIENT_PATH U $ORIGIN 1 SOAP HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $RANDOMID new-display-name Active
java -jar $OPTIONS $SKFSCLIENT_PATH D $ORIGIN 1 SOAP HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4 $RANDOMID
java -jar $OPTIONS $SKFSCLIENT_PATH P $ORIGIN 1 SOAP HMAC 162a5684336fa6e7 7edd81de1baab6ebcc76ebe3e38f41f4

#SOAP PASSWORD
java -jar $OPTIONS $SKFSCLIENT_PATH R $ORIGIN 1 SOAP PASSWORD svcfidouser Abcd1234! $USERNAME $ORIGIN
java -jar $OPTIONS $SKFSCLIENT_PATH A $ORIGIN 1 SOAP PASSWORD svcfidouser Abcd1234! $USERNAME $ORIGIN 1
GETKEYS_OUTPUT=$(java -jar $OPTIONS $SKFSCLIENT_PATH G $ORIGIN 1 SOAP PASSWORD svcfidouser Abcd1234! $USERNAME)
echo $GETKEYS_OUTPUT
RANDOMID=$(echo $GETKEYS_OUTPUT | grep -o -P '(?<=randomid":").*(?=","randomid_)')
java -jar $OPTIONS $SKFSCLIENT_PATH U $ORIGIN 1 SOAP PASSWORD svcfidouser Abcd1234! $RANDOMID new-display-name Active
java -jar $OPTIONS $SKFSCLIENT_PATH D $ORIGIN 1 SOAP PASSWORD svcfidouser Abcd1234! $RANDOMID
java -jar $OPTIONS $SKFSCLIENT_PATH P $ORIGIN 1 SOAP PASSWORD svcfidouser Abcd1234!

echo "Done!"
